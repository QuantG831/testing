<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="favicon.png">
    <title>QuantG â€“ Reset Your Password</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="stylesforforms.css">
    <link rel="stylesheet" href="stylesfornavigationbar.css">
    <link rel="stylesheet" href="../common_style_script/stylesforlogo.css">
    <link rel="stylesheet" href="../common_style_script/stylesforcursor.css">
    <link rel="stylesheet" href="../common_style_script/stylesforfooter.css">
    <link rel="stylesheet" href="../common_style_script/stylesforsharebtn.css">

</head>
<body>
  <div class="header-background"></div>
    <div class="xbody">
  <div class="logo">
    <div class="logo-container">
      <div class="quantg">
        <span class="q">Q</span>
        <span class="u">u</span>
        <span class="a">a</span>
        <span class="n">n</span>
        <span class="t">t</span>
        <span class="g">G</span>
      </div>
      <div class="motto">BEYOND GAMING</div>
    </div>
  </div>

    <!--Header-->
    <header>
        <div class="navigation-bar">
            <div class="navi-text">
                <a href="../Home/index.html" class="items-nav">Home</a>
                <a href="../Explore/allgamepage/index.html" class="items-nav">Explore</a>
                <a href="../login/login.html" class="items-nav">Signup/Login</a>
                <a href="../About/index.html" class="items-nav">About</a>
                <a href="../Contact/index.html" class="items-nav">Contact</a>
                <span id="navigator"></span>
            </div>
        </div>
    </header>

    <div class="container">
        <h1>Password Recovery</h1>

        <!-- Step 1: Enter Email -->
        <div id="email-section">
          <div class="recover-group">
            <input type="email" id="recovery-email" placeholder="" required style="margin-bottom: 1vmax;">
            <label for="email">Enter your email</label>
            <i class="fas fa-envelope recover-icon"></i></div>
            <button id="send-otp">Send OTP</button>
        </div>

        <!-- Step 2: Enter OTP -->
        <div id="otp-section" style="display: none;">
          <div class="recover-group">
            <input type="text" id="otp-input" placeholder="" required style="margin-bottom: 1vmax;">
            <label for="otp">Enter OTP</label>
            <i class="fas fa-key recover-icon"></i></div>
            <button id="verify-otp">Verify OTP</button>
        </div>

        <!-- Step 3: Reset Password -->
        <div id="password-section" style="display: none;">
          <div class="recover-group">
            <input type="password" id="new-password" placeholder="" required style="margin-bottom: 0vmax;">
            <label for="new-password">New Password</label>
            <i class="fas fa-lock recover-icon"></i></div>
            
            <div class="recover-group">
            <input type="password" id="confirm-password" placeholder="" required style="margin-bottom: 1vmax;">
            <label for="confirm-password">Confirm Password</label>
            <i class="fas fa-lock recover-icon"></i></div>

            
            <div class="login-check" style="display: flex;">
              <input type="checkbox" id="showPassword" style="border: none; position: relative;bottom: 1.6vmax;margin-right: 0.4vmax;">
              <label for="showPassword" class="checkbox-label";><p id="showp" style=" position: absolute;bottom: 8.5vmax;color: #c2c0c0;">Show password</p></label>
         </div>

            <button id="reset-password">Reset Password</button>
        </div>

        <p><a href="../login/login.html">Back to Login</a></p>
    </div>

<!-- Share Button and Social Icons -->
<div class="unique-body">
    <!-- Fixed Button to Trigger Icons -->
    <div class="unique-button" id="unique-button">
        <i class="fas fa-share-alt"></i> <!-- Share icon -->
    </div>
    
    <!-- Social Icons (Initially Hidden) -->
    <div class="unique-social-icons" id="unique-social-icons">
        <a href="https://facebook.com" target="_blank" class="facebook"><i class="fab fa-facebook-f"></i></a>
        <a href="https://instagram.com" target="_blank" class="instagram"><i class="fab fa-instagram"></i></a>
        <a href="https://discord.com" target="_blank" class="discord"><i class="fab fa-discord"></i></a>
        <a href="https://github.com" target="_blank" class="github"><i class="fab fa-github"></i></a>
    </div>
</div>

  <!--Footer-->
  <footer>
    <div class="footer">
      <div class="footer-content">
        <p>
            <a href="../Home/index.html">Home</a> | 
            <a href="../Explore/allgamepage/index.html">Explore</a> | 
            <a href="../About/index.html">About us</a> | 
            <a href="../Contact/index.html">Contact us</a>
        </p>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2025 QuantG. All rights reserved.</p>
      </div>
    </div>
  </footer>
</div>

<script type="module">

// javascript for the form
let generatedOTP = null;  // Store OTP for verification

// Show/Hide Password Feature
document.getElementById("showPassword").addEventListener("change", function() {
    let passwordInput = document.getElementById("new-password");
    passwordInput.type = this.checked ? "text" : "password"; // Toggle between 'text' and 'password'
    document.getElementById("showp").textContent = this.checked ? "Hide password" : "Show password"; // Change text based on checkbox state
});
// Show/Hide Password Feature
document.getElementById("showPassword").addEventListener("change", function() {
    let passwordInput = document.getElementById("confirm-password");
    passwordInput.type = this.checked ? "text" : "password"; // Toggle between 'text' and 'password'
    document.getElementById("showp").textContent = this.checked ? "Hide password" : "Show password"; // Change text based on checkbox state
});

// **Send OTP to email**
document.getElementById("send-otp").addEventListener("click", function() {
    const email = document.getElementById("recovery-email").value;

    if (email && validateEmail(email)) {
        // Send OTP request to backend
        fetch("http://localhost:3000/send-otp", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ email: email })
        })
        .then(response => response.json())
        .then(data => {
            console.log("Backend response:", data);  // Debugging response from backend

            if (data.message === "OTP sent successfully!") {
                // Hide the email section and show the OTP section
                document.getElementById("email-section").style.display = "none"; 
                document.getElementById("otp-section").style.display = "block"; // Show OTP input

                alert("OTP sent to your email.");
            } else {
                alert(data.message || "Error sending OTP!");
            }
        })
        .catch(error => {
            console.error("Error:", error);
            alert("An error occurred while sending OTP.");
        });
    } else {
        alert("Please enter a valid email address.");
    }
});

// **Verify OTP**
document.getElementById("verify-otp").addEventListener("click", function() {
    const email = document.getElementById("recovery-email").value; // Get email from the form
    const enteredOTP = document.getElementById("otp-input").value;

    if (enteredOTP) {
        // Verify OTP with backend
        fetch("http://localhost:3000/verify-otp", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ email: email, otp: enteredOTP })
        })
        .then(response => response.json())
        .then(data => {
            if (data.message === "OTP verified successfully!") {
                document.getElementById("otp-section").style.display = "none";
                document.getElementById("password-section").style.display = "block";
            } else {
                alert(data.message || "Invalid OTP! Please try again.");
            }
        })
        .catch(error => {
            console.error("Error:", error);
            alert("An error occurred while verifying OTP.");
        });
    } else {
        alert("Please enter OTP.");
    }
});

// **Reset Password**
document.getElementById("reset-password").addEventListener("click", function() {
    const email = document.getElementById("recovery-email").value; // Get email from the form
    const newPassword = document.getElementById("new-password").value;
    const confirmPassword = document.getElementById("confirm-password").value;

    if (newPassword && confirmPassword) {
        if (newPassword === confirmPassword) {
            // Send password reset request to backend
            fetch("http://localhost:3000/reset-password", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ email: email, newPassword: newPassword })
            })
            .then(response => response.json())
            .then(data => {
                if (data.message === "Password reset successful!") {
                    alert("Password successfully reset!");
                    window.location.href = "../login/login.html"; // Redirect to login page
                } else {
                    alert(data.message || "Error resetting password.");
                }
            })
            .catch(error => {
                console.error("Error:", error);
                alert("An error occurred while resetting the password.");
            });
        } else {
            alert("Passwords do not match!");
        }
    } else {
        alert("Please fill in both password fields.");
    }
});

// Helper function to validate email format
function validateEmail(email) {
    const re = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/;
    return re.test(String(email).toLowerCase());
}

</script>
<script src="../common_style_script/scriptforfooter.js"></script>
<script src="../common_style_script/scriptformouseflare.js"></script>
<script src="../common_style_script/scriptforavigationbar.js"></script>
<script src="../common_style_script/scriptforsocialicons.js" defer></script>
    
</body>
</html>
